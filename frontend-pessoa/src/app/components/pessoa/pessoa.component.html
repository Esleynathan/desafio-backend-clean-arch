<div class="container">
  <h2>Gerenciamento de Pessoas</h2>

  <!-- Formulário de Cadastro/Edição -->
  <div class="card">
    <h3>{{ pessoa.id ? 'Editar Pessoa' : 'Nova Pessoa' }}</h3>
    <form (ngSubmit)="salvar()">
      <div class="form-row">
        <div class="form-group">
          <label for="nome">Nome:</label>
          <input type="text" id="nome" name="nome" [(ngModel)]="pessoa.nome" required placeholder="Ex: João Silva">
        </div>
        <div class="form-group">
          <label for="cpf">CPF:</label>
          <input type="text" id="cpf" name="cpf" [(ngModel)]="pessoa.cpf" required placeholder="000.000.000-00">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="data_nascimento">Data de Nascimento:</label>
          <input type="date" id="data_nascimento" name="data_nascimento" [(ngModel)]="pessoa.data_nascimento" required>
        </div>
        <div class="form-group">
          <label for="sexo">Sexo:</label>
          <select id="sexo" name="sexo" [(ngModel)]="pessoa.sexo" required>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="altura">Altura (m):</label>
          <input type="number" step="0.01" id="altura" name="altura" [(ngModel)]="pessoa.altura" required placeholder="Ex: 1.75">
        </div>
        <div class="form-group">
          <label for="peso">Peso (kg):</label>
          <input type="number" step="0.1" id="peso" name="peso" [(ngModel)]="pessoa.peso" required placeholder="Ex: 70.5">
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="btn-save">{{ pessoa.id ? 'Atualizar' : 'Cadastrar' }}</button>
        <button type="button" class="btn-cancel" (click)="limparFormulario()" *ngIf="pessoa.id">Cancelar Edição</button>
      </div>
    </form>
  </div>

  <hr>

  <!-- Barra de Pesquisa -->
  <div class="search-bar">
    <input type="text" name="termoBusca" placeholder="Pesquisar por nome..." [(ngModel)]="termoBusca">
    <button (click)="pesquisar()">Pesquisar</button>
    <button class="btn-cancel" (click)="limparPesquisa()">Limpar</button>
  </div>

  <!-- Tabela de Listagem -->
  <h3>Lista de Pessoas</h3>
  <table class="tabela-pessoas">
    <thead>
      <tr>
        <th>Nome</th>
        <th>CPF</th>
        <th>Nascimento</th>
        <th>Sexo</th>
        <th>Altura</th>
        <th>Peso</th>
        <th>Peso Ideal</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of pessoas">
        <td>{{ p.nome }}</td>
        <td>{{ p.cpf }}</td>
        <td>{{ p.data_nascimento | date:'dd/MM/yyyy' }}</td>
        <td>{{ p.sexo === 'M' ? 'Masculino' : 'Feminino' }}</td>
        <td>{{ p.altura }} m</td>
        <td>{{ p.peso }} kg</td>
        <td>
          <!-- Exibe o peso ideal formatado se existir -->
          <span *ngIf="p.peso_ideal" style="font-weight: bold; color: green;">
            {{ p.peso_ideal | number:'1.2-2' }} kg
          </span>
          <button *ngIf="!p.peso_ideal" class="btn-calc" (click)="calcularPeso(p)" title="Clique para calcular">
            Calcular
          </button>
        </td>
        <td>
          <button class="btn-edit" (click)="editar(p)">Editar</button>
          <button class="btn-delete" (click)="excluir(p.id!)">Excluir</button>
        </td>
      </tr>
      <tr *ngIf="pessoas.length === 0">
        <td colspan="8" style="text-align: center; padding: 20px;">Nenhuma pessoa cadastrada.</td>
      </tr>
    </tbody>
  </table>
</div>
